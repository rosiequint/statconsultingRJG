---
title: "Stat Consulting Project - Exploratory Analysis"
author: "Rosie Quint"
date: "2026-02-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## This will go in section 1 
```{r}
library(haven)
library(tidyverse)
all_data <- read_dta("ZZIR62FL.DTA")

# extract relevant variables
selected_data <- all_data %>%
  select(
    caseid, 
    v012, # age at questioning
    v505, # how many other wives 
    v632, # husband as contraception decision-maker: 1 = mainly respondent, 2 = mainly husband,partner, 3 = joint decision, 6 = other, 9 = missing
    v744a, v744b, v744c, v744d, v744e, # believes beating justified - different reasons
    v763a, # any STI last 12 months
    v812, v813, # presence of husband for wife-beating question / presence of other male
    v745a, v745b, # owns house alone/jointly, owns land alone/jointly 
    v508, # year of first cohabitation
    v822, # wife justified asking husband to use condom if he has STI
    v301, # knowledge of any method of contraception
    v474a, v474b, v474c, v474d, v474e, v474f, # knowldge about TB - spread by different methods
    v751, # ever heard of AIDS, couldn't find 751BP-WP
    v777,# shame about HIV (couldn't find 777a)
    v746 ) # earns more than husband: 1 = more than him, 2 = less, 3 = about the same, 4 = husband brings in no money, 8 = dont know, 9 = missing
```

# Section 2: Descriptives 
## Creating new variables 
```{r}
# create man listening variable based on if either v812 (husband listening) or v813 (other man listening) is true 
selected_data <- selected_data %>%
  mutate(
    man_listening = factor(ifelse(v812 == 1 | v813 == 1 , 1, 0)), # 0 = no, 1 = yes - listening, 2 = not-listening, 9 = missing
    anybeating_justified = ifelse(v744a == 1 | v744b == 1 | v744c == 1 | v744d == 1 | v744e == 1, 1, 0),
    owns_house_or_land = ifelse(v745a == 1 | v745b == 1, 1, 0),
    age_first_cohab = v012 - (2015 - v508)
         )
```

## Exploratory plots and descriptives


### Summarise a binary variable (man_listening)
```{r}
summary(selected_data$man_listening)
```

### Summmarise a continuous variable with histograms
```{r}
# create histogram for number of other wives (v505)
ggplot(data = selected_data, aes(x = v505)) +
  geom_histogram(binwidth = 1) + # add title
  ggtitle("Distribution of Number of Co-Wives (v505)")

# remove outliers in v505 (those with more than 10 co-wives) - these are likely data errors
selected_data_cleaned <- selected_data %>%
  filter(v505 <= 10)

# same histogram with outlier removed 
ggplot(data = selected_data_cleaned, aes(x = v505)) +
  geom_histogram(binwidth = 1) + 
  ggtitle("Distribution of Number of Co-Wives (v505) with Outliers Removed")
```

### Plot data stratified by a variable 
```{r}
# investigate husband as contraception decision-maker variable 
summary(selected_data$v632)
# plot husband as contraception decision-maker
ggplot(data = selected_data, aes(x = v632)) +
  geom_bar() +
  ggtitle("Distribution of Husband as Contraception Decision-Maker (v632)") + 
  scale_x_continuous(breaks = c(1, 2, 3, 6), labels = c("Mainly respondent", "Mainly husband/partner", "Joint decision", "Other")) + 
  theme_minimal()


# plot husband as decision-maker, stratified by mann listening 
plot_df <- selected_data %>%
  filter(!is.na(v632), !is.na(man_listening)) %>%
  mutate(
    v632 = factor(
      v632,
      levels = c(1, 2, 3, 6),
      labels = c(
        "Mainly respondent",
        "Mainly husband/partner",
        "Joint decision",
        "Other"
      )
    )
  ) %>%
  group_by(man_listening, v632) %>%
  summarise(n = n(), .groups = "drop") %>%
  group_by(man_listening) %>%
  mutate(percent = n / sum(n) * 100)

ggplot(plot_df, aes(x = v632, y = percent, fill = factor(man_listening))) +
  geom_col(position = "dodge") +
  labs(
    x = "Who decides about contraception",
    y = "Percent within listening group",
    fill = "Man listens"
  ) +
  theme_minimal()
```

Descriptives related to predictors in question 1- violin plot for with man listening vs without

```{r}
# plot number of other wives (v505) distribution by man_listening status
ggplot(data = selected_data, aes(x = man_listening, y = v505)) +
  geom_violin() + 
  ggtitle("Distribution of number of other wives (v505) by man listening status")

ggplot(data = selected_data_cleaned, aes(x = man_listening, y = v505)) +
  geom_violin() + 
  ggtitle("Distribution of number of other wives (v505) by man listening status, outliers removed ")

```

## Table 1 variable summary
First, we are going to load the R package table1, which will do most of the heavy lifting for us! 
```{r}
library(table1)
```

Then, we will select the variables we are interested in summarizing
```{r}
table1_data <- selected_data %>%
  select(v012, v632, v505, man_listening, anybeating_justified)
```

Ensure variables ar in the correct format (numeric if we want to report means and standard deviations or factor if we want to report percentages)
```{r}
table1_data <- table1_data %>%
  mutate(
    v012 = as.numeric(v012),
    v505 = as.numeric(v505),

    v632 = factor(
      v632,
      levels = c(1, 2, 3, 6),
      labels = c(
        "Mainly respondent decides",
        "Mainly husband/partner decides",
        "Joint decision",
        "Other"
      )
    ),

    man_listening = factor(
      man_listening,
      levels = c(0, 1),
      labels = c("No", "Yes")
    )
  )
```

Add labels to be included in the table
```{r}
label(table1_data$v012)  <- "Age at interview (years)"
label(table1_data$v505) <- "Number of co-wives"
label(table1_data$v632) <- "Husband decides on contraception"
label(table1_data$anybeating_justified) <- "YES to any wife beating justified questions"
label(table1_data$man_listening) <- "Any man listening"
```

Generate table 1
```{r}
table1(
  ~ v012 + v505 + v632 +
    anybeating_justified + man_listening,
  data = table1_data
)
```

Optional: generate table 1 stratified by man listening status
```{r}
# table 1 stratified by man listening status
# remove those with missing data for man_listening variable
table1_data_strat <- table1_data %>%
  filter(!is.na(man_listening))

table1(
  ~ v012 + v505 + v632 + anybeating_justified | man_listening,
  data = table1_data_strat
)
```


