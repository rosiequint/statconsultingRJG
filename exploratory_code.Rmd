---
title: "Stat Consulting Project - Exploratory Analysis"
author: "Rosie Quint"
date: "2026-02-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(haven)
library(tidyverse)

all_data <- read_dta("ZZIR62FL.DTA")

# extract relevant variables
selected_data <- all_data %>%
  select(
    v012, # age at questioning
    v505, # how many other wives 
    v632, # husband as contraception decision-maker
    v744a, v744b, v744c, v744d, v744e, # believes beating justified - different reasons
    v763a, # any STI last 12 months
    v812, v813, # presence of husband for wife-beating question / presence of other male
    v745a, v745b, # owns house alone/jointly, owns land alone/jointly 
    v508, # year of first cohabitation
    v822, # wife justified asking husband to use condom if he has STI
    v301, # knowledge of any method of contraception
    v474a, v474b, v474c, v474d, v474e, v474f, # knowldge about TB - spread by different methods
    v751, # ever heard of AIDS
    v777) # shame about HIV (couldn't find 777a)

# write_csv(selected_data, "selected_data.csv")

# create man listening variable based on if either v812 (husband listening) or v813 (other man listening) is true 
selected_data <- selected_data %>%
  mutate(man_listening = factor(ifelse(v812 > 0  | v813 > 0 , 1, 0)), # CHECK THIS - what does coding '2' mean here?
         anybeating_justified = ifelse(v744a == 1 | v744b == 1 | v744c == 1 | v744d == 1 | v744e == 1, 1, 0),
         owns_house_or_land = ifelse(v745a == 1 | v745b == 1, 1, 0),
         tb_knowledge = ifelse(v474a == 1 | v474b == 1 | v474c == 1 | v474d == 1 | v474e == 1 | v474f == 1, 1, 0) # all NAs
  )


# remove those with missing data for man_listening variable
selected_data_filtered <- selected_data %>%
  filter(!is.na(man_listening))

hist(selected_data_filtered$v505) + 
  title("Distribution of Number of Other Wives (v505)")

# output proportion Husband as Contraception Decision-Maker (v632)")
prop_husband_decision_maker <- mean(selected_data_filtered$v632 == 1, na.rm = TRUE)
print(prop_husband_decision_maker)

# output proportion believing beating is justified
prop_beating_justified <- mean(selected_data_filtered$anybeating_justified, na.rm = TRUE)
print(prop_beating_justified)

# output proportion with STI in last 12 months (v763a)
prop_sti_last_12_months <- mean(selected_data_filtered$v763a == 1, na.rm = TRUE)
print(prop_sti_last_12_months)
```

```{r}
library(table1)

selected_data_filtered <- selected_data_filtered %>%
  mutate(
    ## demographics
    v012 = as.numeric(v012),   # age
    v505 = as.numeric(v505),   # number of co-wives
    v508 = as.numeric(v508),   # year first cohabitation
    
    ## binary / categorical DHS variables â†’ factors
    across(
      c(
        v632,      # husband decides contraception
        v744a, v744b, v744c, v744d, v744e,  # beating justified reasons
        v763a,     # STI last 12 months
        v812, v813,# presence during interview
        v745a, v745b, # house / land ownership
        v822,      # justified asking condom
        v301,      # knows contraception
        v474a, v474b, v474c, v474d, v474e, v474f, # TB knowledge items
        v751,      # ever heard of AIDS
        v777       # shame about HIV
      ),
      ~ factor(.)
    )
  )

label(selected_data_filtered$v012)  <- "Age at interview (years)"
label(selected_data_filtered$v505) <- "Number of co-wives"
label(selected_data_filtered$v508) <- "Year of first cohabitation"

label(selected_data_filtered$v632) <- "Husband decides on contraception"

label(selected_data_filtered$v744a) <- "Beating justified: goes out without telling"
label(selected_data_filtered$v744b) <- "Beating justified: neglects children"
label(selected_data_filtered$v744c) <- "Beating justified: argues with husband"
label(selected_data_filtered$v744d) <- "Beating justified: refuses sex"
label(selected_data_filtered$v744e) <- "Beating justified: burns food"

label(selected_data_filtered$v763a) <- "Had STI in last 12 months"

label(selected_data_filtered$v812) <- "Husband present during interview"
label(selected_data_filtered$v813) <- "Other male present during interview"

label(selected_data_filtered$v745a) <- "Owns house"
label(selected_data_filtered$v745b) <- "Owns land"

label(selected_data_filtered$v822) <- "Justified asking condom if husband has STI"
label(selected_data_filtered$v301) <- "Knows any contraceptive method"


label(selected_data_filtered$v751) <- "Ever heard of AIDS"
label(selected_data_filtered$v777) <- "Feels shame if HIV positive"


table1(
  ~ v012 + v505 + v508 +
    v632 +
    v744a + v744b + v744c + v744d + v744e +
    v763a +
    v812 + v813 +
    v745a + v745b +
    v822 + v301 +
    v751 + v777,
  data = selected_data_filtered
)

table1(
  ~ v012 + v505 + v508 +
    v632 +
    v763a +
    v812 + v813 +
    v745a + v745b +
    v822 + v301 +
    v751 + v777 | man_listening,
  data = selected_data_filtered
)

```



Descriptives related to predictors in question 1-  violin plot for with man listening vs without 
```{r}
# plot number of other wives (v505) distribution by man_listening status
ggplot(data = selected_data_filtered, aes(x = man_listening, y = v505)) +
  geom_violin()

# plot husband as contraception decision-maker (v632) by man_listening status
ggplot(data = selected_data_filtered_filtered, aes(x = man_listening, y = v632)) +
  geom_violin()
```